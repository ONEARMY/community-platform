"use strict";(self.webpackChunkoa_docs=self.webpackChunkoa_docs||[]).push([[501],{1581:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var o=a(4848),n=a(8453);const s={id:"firestore-backup",title:"Firestore DB Backup"},r=void 0,i={id:"Backend Development/firestore-backup",title:"Firestore DB Backup",description:"Automated Backups",source:"@site/docs/Backend Development/firestore-backup.md",sourceDirName:"Backend Development",slug:"/Backend Development/firestore-backup",permalink:"/Backend Development/firestore-backup",draft:!1,unlisted:!1,editUrl:"https://github.com/ONEARMY/community-platform/edit/master/packages/documentation/docs/Backend Development/firestore-backup.md",tags:[],version:"current",frontMatter:{id:"firestore-backup",title:"Firestore DB Backup"},sidebar:"mainSidebar",previous:{title:"Firebase Emulator",permalink:"/Backend Development/firebase-emulator"},next:{title:"Integrations",permalink:"/Backend Development/integrations"}},c={},d=[{value:"Automated Backups",id:"automated-backups",level:2},{value:"Configuring Permissions",id:"configuring-permissions",level:3},{value:"Manual Backup",id:"manual-backup",level:2},{value:"Restoring Backups",id:"restoring-backups",level:2}];function l(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",p:"p",strong:"strong",...(0,n.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"automated-backups",children:"Automated Backups"}),"\n",(0,o.jsxs)(t.p,{children:["The platform includes a firebase function to automatically create a database backup on a schedule.\nCurrently a backup is created as part of the ",(0,o.jsx)(t.a,{href:"https://github.com/ONEARMY/community-platform/blob/49fa7433cf4a9e348a4436d55fd3313daa70edda/functions/src/scheduled/tasks.ts",children:"weeklyTasks"})," schedule, triggered every Sunday at 2am"]}),"\n",(0,o.jsxs)(t.p,{children:["The backup only takes an export of database tables currently in use. For backups of the entire database see ",(0,o.jsx)(t.a,{href:"#manual-backup",children:"Manual Backup"})," below"]}),"\n",(0,o.jsxs)(t.p,{children:["The export will automatically be populated into the default storage bucket, in an ",(0,o.jsx)(t.em,{children:"backups"})," folder"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:a(1623).A+"",width:"791",height:"482"})}),"\n",(0,o.jsx)(t.h3,{id:"configuring-permissions",children:"Configuring Permissions"}),"\n",(0,o.jsx)(t.p,{children:"In order to allow automated backups, additional permissions are likely to be required on the service account that firebase uses. By default this should be the account named"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.code,{children:"PROJECT_ID@appspot.gserviceaccount.com"})}),"\n",(0,o.jsxs)(t.p,{children:["Permissions can be configured on the ",(0,o.jsx)(t.a,{href:"https://console.cloud.google.com/iam-admin/iam",children:"Google Cloud IAM"})," page. As a minimum, ",(0,o.jsx)(t.strong,{children:"Cloud Datastore"})," access will be required"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:a(6111).A+"",width:"336",height:"279"})}),"\n",(0,o.jsxs)(t.p,{children:["See more info at:",(0,o.jsx)(t.br,{}),"\n",(0,o.jsx)(t.a,{href:"https://cloud.google.com/firestore/docs/manage-data/export-import",children:"https://cloud.google.com/firestore/docs/manage-data/export-import"})]}),"\n",(0,o.jsx)(t.h2,{id:"manual-backup",children:"Manual Backup"}),"\n",(0,o.jsxs)(t.p,{children:["Full or custom backups of the database can be created from the ",(0,o.jsx)(t.a,{href:"https://console.cloud.google.com/firestore/import-export",children:"Firestore Import Export"})," page on Google Cloud console"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:a(2880).A+"",width:"1123",height:"842"})}),"\n",(0,o.jsx)(t.h2,{id:"restoring-backups",children:"Restoring Backups"}),"\n",(0,o.jsx)(t.p,{children:"Backups can also be restored from the Firestore Import Export page"}),"\n",(0,o.jsx)(t.admonition,{type:"danger",children:(0,o.jsx)(t.p,{children:"Any existing data may be replaced and lost during restore operations"})}),"\n",(0,o.jsxs)(t.p,{children:["Alternatively the backup could be loaded into the emulator and data queried from there as required.",(0,o.jsx)(t.br,{}),"\n","See the ",(0,o.jsx)(t.a,{href:"/Backend%20Development/firebase-emulator",children:"Firebase Emulator"})," for more information"]})]})}function u(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},2880:(e,t,a)=>{a.d(t,{A:()=>o});const o=a.p+"assets/images/firestore-backup-console-4e3f46b40731ed9b60b82addbaa21061.png"},1623:(e,t,a)=>{a.d(t,{A:()=>o});const o=a.p+"assets/images/firestore-backup-folder-5346018e0f40e7a76ea030f6d4ca6904.png"},6111:(e,t,a)=>{a.d(t,{A:()=>o});const o=a.p+"assets/images/firestore-backup-permissions-411088a5bdef07da6a48a81e9f43c963.png"},8453:(e,t,a)=>{a.d(t,{R:()=>r,x:()=>i});var o=a(6540);const n={},s=o.createContext(n);function r(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);