"use strict";(self.webpackChunkoa_docs=self.webpackChunkoa_docs||[]).push([[141],{6376:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var o=r(4848),t=r(8453);const a={id:"manualBackups",title:"Manual Backups"},i=void 0,s={id:"Server Maintenance/manualBackups",title:"Manual Backups",description:"In order to fully backup the platform there are 3 areas that need to be backed up:",source:"@site/docs/Server Maintenance/manual-backups.md",sourceDirName:"Server Maintenance",slug:"/Server Maintenance/manualBackups",permalink:"/Server Maintenance/manualBackups",draft:!1,unlisted:!1,editUrl:"https://github.com/ONEARMY/community-platform/edit/master/packages/documentation/docs/Server Maintenance/manual-backups.md",tags:[],version:"current",frontMatter:{id:"manualBackups",title:"Manual Backups"},sidebar:"mainSidebar",previous:{title:"Automated Backup and Migration",permalink:"/Server Maintenance/dataMigration"},next:{title:"Environmental Impact",permalink:"/Environmental Impact/environmental-impact"}},c={},l=[{value:"Importing Data from a Backup",id:"importing-data-from-a-backup",level:2},{value:"Migrate/Clone",id:"migrateclone",level:2},{value:"Service worker",id:"service-worker",level:2}];function d(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"In order to fully backup the platform there are 3 areas that need to be backed up:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Firestore Database\n",(0,o.jsx)(n.a,{href:"https://console.cloud.google.com/firestore/import-export?project=onearmyworld",children:"https://console.cloud.google.com/firestore/import-export?project=onearmyworld"})]}),"\n",(0,o.jsxs)(n.p,{children:["Use in interactive export tool to create a backup of the database. If the data is simply for re-importing later the entire database can be selected. If only some specific data collections are likely to be imported, or tools like bigquery will be used to analyse the exported data then individual collections should be specified (e.g. ",(0,o.jsx)(n.code,{children:"v3_howtos"}),")"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:r(2901).A+"",width:"839",height:"786"})}),"\n",(0,o.jsxs)(n.p,{children:["The backup can be made to the existing ",(0,o.jsx)(n.code,{children:"onearmyworld-exports"})," bucket, or a personal storage bucket. Exports should be named in a consistent way, prefixed with a timestamp (",(0,o.jsx)(n.code,{children:"yyyy-mm-dd"}),")"]}),"\n",(0,o.jsxs)(n.p,{children:["The backup can also be downloaded locally using the ",(0,o.jsx)(n.a,{href:"https://cloud.google.com/storage/docs/gsutil",children:"gsutil"})," tool"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"gsutil cp -r gs://onearmyworld-exports/name-of-backup ./my-local-backup-folder\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Firebase Storage\nThis is a bucket in firebase cloud storage, and so can be handled in a similar way to the firestore database, via the gcloud console"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:r(1102).A+"",width:"1014",height:"504"})}),"\n",(0,o.jsxs)(n.p,{children:["Additionally, files can be downloaded to backup locally or to another storage provider via ",(0,o.jsx)(n.a,{href:"https://cloud.google.com/storage/docs/gsutil",children:"gsutil"})," run from a local command line, e.g."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"gsutil cp -r \\\ngs://onearmyworld.appspot.com/uploads \\\n./my-local-backup-folder\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Firebase Auth Users",(0,o.jsx)(n.br,{}),"\n","See documentation: ",(0,o.jsx)(n.a,{href:"https://firebase.google.com/docs/cli/auth",children:"https://firebase.google.com/docs/cli/auth"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"importing-data-from-a-backup",children:"Importing Data from a Backup"}),"\n",(0,o.jsx)(n.p,{children:"The same graphical interface can be used to import data. However care should be taken before importing in case of unintended side-effects."}),"\n",(0,o.jsx)(n.p,{children:"Specifically firebase functions should first be disabled and data may need to first be deleted from the target project."}),"\n",(0,o.jsx)(n.admonition,{type:"danger",children:(0,o.jsx)(n.p,{children:"If functions are triggered on database changes they will be triggered for every document that is imported"})}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsx)(n.p,{children:"When importing a collection any existing data will be merged with the import."})}),"\n",(0,o.jsx)(n.h2,{id:"migrateclone",children:"Migrate/Clone"}),"\n",(0,o.jsx)(n.p,{children:"In order to migrate the data to another server similar steps must be taken and permissions"}),"\n",(0,o.jsx)(n.h2,{id:"service-worker",children:"Service worker"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["activate required api: ",(0,o.jsx)(n.a,{href:"https://console.cloud.google.com/apis/api/cloudresourcemanager.googleapis.com",children:"https://console.cloud.google.com/apis/api/cloudresourcemanager.googleapis.com"})]}),"\n",(0,o.jsx)(n.li,{children:"creating"}),"\n",(0,o.jsxs)(n.li,{children:["permissions (easiest to assign as viewer for source, and datastore import/export target)","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Source firestore - viewer"}),"\n",(0,o.jsx)(n.li,{children:"Target firestore - viewer, datastore import/export"}),"\n",(0,o.jsx)(n.li,{children:"Storage bucket - storage admin"}),"\n",(0,o.jsx)(n.li,{children:"Service Account User"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://cloud.google.com/firestore/docs/security/iam#roles",children:"https://cloud.google.com/firestore/docs/security/iam#roles"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://cloud.google.com/iam/docs/granting-changing-revoking-access",children:"https://cloud.google.com/iam/docs/granting-changing-revoking-access"})}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Check"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"gcloud projects list\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"gcloud auth list\n"})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},2901:(e,n,r)=>{r.d(n,{A:()=>o});const o=r.p+"assets/images/firestore-backup-1-533178e0157316bc3f68bd140b8e4a77.png"},1102:(e,n,r)=>{r.d(n,{A:()=>o});const o=r.p+"assets/images/firestore-backup-2-8c9013a546820b0de1046fb0ff874581.png"},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>s});var o=r(6540);const t={},a=o.createContext(t);function i(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);