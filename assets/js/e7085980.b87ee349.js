"use strict";(self.webpackChunkoa_docs=self.webpackChunkoa_docs||[]).push([[217],{4563:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(4848),t=n(8453);const i={},r="What is Supabase?",o={id:"supabase",title:"What is Supabase?",description:"Supabase is an open source Firebase alternative, based on Postgres.",source:"@site/docs/supabase.md",sourceDirName:".",slug:"/supabase",permalink:"/supabase",draft:!1,unlisted:!1,editUrl:"https://github.com/ONEARMY/community-platform/edit/master/packages/documentation/docs/supabase.md",tags:[],version:"current",frontMatter:{}},l={},c=[{value:"Getting Started",id:"getting-started",level:2},{value:"Local supabase instance",id:"local-supabase-instance",level:3},{value:"Updating local supabase",id:"updating-local-supabase",level:3},{value:"Using online Supabase free version",id:"using-online-supabase-free-version",level:3},{value:"Create your Supabase instance",id:"create-your-supabase-instance",level:4},{value:"Link your Supabase instance and push the db schema",id:"link-your-supabase-instance-and-push-the-db-schema",level:4},{value:"Migrations",id:"migrations",level:2},{value:"Running Cypress Tests",id:"running-cypress-tests",level:2},{value:"Supabase Edge Functions",id:"supabase-edge-functions",level:2},{value:"Cypress with Supabase",id:"cypress-with-supabase",level:3},{value:"Local firebase sync testing/debugging",id:"local-firebase-sync-testingdebugging",level:3}];function u(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"what-is-supabase",children:"What is Supabase?"})}),"\n",(0,a.jsx)(s.p,{children:"Supabase is an open source Firebase alternative, based on Postgres."}),"\n",(0,a.jsx)(s.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,a.jsx)(s.h3,{id:"local-supabase-instance",children:"Local supabase instance"}),"\n",(0,a.jsxs)(s.p,{children:["To install the supabase locally, follow ",(0,a.jsx)(s.a,{href:"https://supabase.com/docs/guides/local-development/cli/getting-started?queryGroups=platform&platform=windows",children:"https://supabase.com/docs/guides/local-development/cli/getting-started?queryGroups=platform&platform=windows"}),"\nInstalling as a dev dependency doesn't always work well, so it is recommended to install for your OS."]}),"\n",(0,a.jsx)(s.p,{children:"Install Docker Desktop.\nMake sure you have the docker app open."}),"\n",(0,a.jsxs)(s.p,{children:["Run ",(0,a.jsx)(s.code,{children:"supabase start"})," (Ensure you run it on the project folder root.)\nRun ",(0,a.jsx)(s.code,{children:"supabase status"}),"\nCreate a .env.local file at the project root (same level as .env) and fill in the keys with values from the command above:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"SUPABASE_API_URL=<API URL>\nSUPABASE_KEY=<anon key>\nSUPABASE_SERVICE_ROLE_KEY=<service_role key>\n"})}),"\n",(0,a.jsxs)(s.p,{children:["Run ",(0,a.jsx)(s.code,{children:"yarn db:seed"})," to run the DB migration scripts and update your local database schema. You will have to run this again whenever there are DB schema changes."]}),"\n",(0,a.jsxs)(s.p,{children:["Now you can start the project with ",(0,a.jsx)(s.code,{children:"yarn start"}),".\nTo sign-up locally, you can get the email confirmation link at ",(0,a.jsx)(s.a,{href:"http://localhost:54324/monitor",children:"http://localhost:54324/monitor"})]}),"\n",(0,a.jsx)(s.h3,{id:"updating-local-supabase",children:"Updating local supabase"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.a,{href:"https://supabase.com/docs/guides/local-development/cli/getting-started?queryGroups=platform&platform=macos#updating-the-supabase-cli",children:"https://supabase.com/docs/guides/local-development/cli/getting-started?queryGroups=platform&platform=macos#updating-the-supabase-cli"})}),"\n",(0,a.jsx)(s.h3,{id:"using-online-supabase-free-version",children:"Using online Supabase free version"}),"\n",(0,a.jsx)(s.h4,{id:"create-your-supabase-instance",children:"Create your Supabase instance"}),"\n",(0,a.jsxs)(s.p,{children:["You can also use the online Supabase free version.\nFor this, create your Supabase account at ",(0,a.jsx)(s.a,{href:"https://supabase.com",children:"https://supabase.com"})," and create a new project.\nInstall the Supabase CLI : ",(0,a.jsx)(s.a,{href:"https://supabase.com/docs/guides/local-development/cli/getting-started",children:"https://supabase.com/docs/guides/local-development/cli/getting-started"})]}),"\n",(0,a.jsx)(s.h4,{id:"link-your-supabase-instance-and-push-the-db-schema",children:"Link your Supabase instance and push the db schema"}),"\n",(0,a.jsxs)(s.p,{children:["First, connect to the Supabase CLI using ",(0,a.jsx)(s.code,{children:"supabase login"}),".\nGet your project-id from your Supabase project, you can find it in the project settings general section.\nNow from the project root, run ",(0,a.jsx)(s.code,{children:"supabase link --project-ref your-project-id"}),".\nFinally, push your schema using ",(0,a.jsx)(s.code,{children:"supabase db push"}),"."]}),"\n",(0,a.jsx)(s.p,{children:'To finish you should fill the .env.local file with the values from the "Data API" section of your project settings:'}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"SUPABASE_API_URL=<API URL>\nSUPABASE_KEY=<anon key>\nSUPABASE_SERVICE_ROLE_KEY=<service_role key>\n"})}),"\n",(0,a.jsx)(s.h2,{id:"migrations",children:"Migrations"}),"\n",(0,a.jsxs)(s.p,{children:["We use Supabase Declarative Schemas feature.\nSchema changes must be made in the /supabase/schemas folder, following the current pattern (1 sql file per feature).\nAfter making the schema changes, a migration file needs to be generated, use this command:\n",(0,a.jsx)(s.code,{children:"supabase db diff --file [migration_name]"})]}),"\n",(0,a.jsx)(s.h2,{id:"running-cypress-tests",children:"Running Cypress Tests"}),"\n",(0,a.jsxs)(s.p,{children:["Create a .env.local file at the packages/cypress folder\nSUPABASE_API_URL=your_api_key (probably ",(0,a.jsx)(s.a,{href:"http://127.0.0.1:54321",children:"http://127.0.0.1:54321"}),")\nSUPABASE_KEY=your_key\nSUPABASE_SERVICE_ROLE_KEY=your service key"]}),"\n",(0,a.jsx)(s.p,{children:"All done! Tests will use your local database. More info about how it works below."}),"\n",(0,a.jsx)(s.h2,{id:"supabase-edge-functions",children:"Supabase Edge Functions"}),"\n",(0,a.jsxs)(s.p,{children:["Currently used for customizing Auth Emails.\nSupabase Auth Hooks have a timeout of 5 seconds which can easily be exceeded. To reduce the risk, the ",(0,a.jsx)(s.code,{children:"resend"})," call is not awaited.\nIf it is exceeded, the user gets an error on the UI, but still receives the email and can continue his flow.\nHaven't managed to run the functions locally yet (contributions welcome!)."]}),"\n",(0,a.jsx)(s.h3,{id:"cypress-with-supabase",children:"Cypress with Supabase"}),"\n",(0,a.jsx)(s.p,{children:"Running cypress tests locally will use the local database, while running on CI will use the QA database.\nFor each test run, a new tenant_id is generated, which has a few benefits:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"ensures no conflicts between parallel test runs"}),"\n",(0,a.jsx)(s.li,{children:"easier to cleanup"}),"\n",(0,a.jsxs)(s.li,{children:["if the data isn't cleaned for some reason, it won't affect other runs\nFor each test file, there should be a ",(0,a.jsx)(s.code,{children:"before"})," and ",(0,a.jsx)(s.code,{children:"after"})," block to, respectively, seed and clean the database."]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"local-firebase-sync-testingdebugging",children:"Local firebase sync testing/debugging"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.em,{children:"This is temporary until we fully migrate to supabase!"}),"\nWe can create and deploy the sync function to the firebase dev environment.\nThen, using ngrok, expose our local supabase url to the internet, and point the firebase function to it.\n(ngrok http ",(0,a.jsx)(s.a,{href:"http://127.0.0.1:54321",children:"http://127.0.0.1:54321"}),")"]}),"\n",(0,a.jsxs)(s.p,{children:["To authenticate, we need to create these 3 secrets, for each firebase project:\nfirebase functions:secrets",":set"," SUPABASE_API_URL\nfirebase functions:secrets",":set"," SUPABASE_API_KEY\nfirebase functions:secrets",":set"," TENANT_ID\n(Check values with firebase functions:secrets",":access"," SECRET_NAME)"]})]})}function d(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>o});var a=n(6540);const t={},i=a.createContext(t);function r(e){const s=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(i.Provider,{value:s},e.children)}}}]);