import{r as l,j as e,k as U,l as k}from"./iframe-Dyks2otr.js";import{B as y}from"./Button-Crx8d9tC.js";import{F as a,C as S,I as B,b as q,T as f,a as C}from"./theme-ui-components.esm-CrX3Ask8.js";import{d as L}from"./default_member-D4npYF8S.js";import{L as A}from"./LinkifyText-Cgik3BnQ.js";import{D}from"./DisplayDate-DIcjBIJd.js";import{I as R}from"./Icon-DFjAuwHv.js";import{U as E}from"./Username-CZlflJrB.js";const w=({children:t,itemType:n})=>{const[o,i]=l.useState(!1),r=l.useRef(null),s=t.filter((e=>!!e));if(!t||0===s.length)return e.jsx(e.Fragment,{});return l.useEffect((()=>{const e=e=>{r.current&&!r.current.contains(e.target)&&i((e=>!e))};return o&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[o]),e.jsxs(a,{ref:r,sx:{display:"inline-block",position:"relative",gap:2},children:[e.jsx(y,{"data-cy":`${n}: ActionSetButton`,icon:"more-vert",onClick:()=>i((e=>!e)),variant:"subtle",small:!0,showIconOnly:!0,children:"Show Actions"}),o&&e.jsx(S,{sx:{position:"absolute",right:0,zIndex:10,gap:1,minWidth:"200px"},children:e.jsxs(a,{sx:{alignItems:"stretch",justifyItems:"stretch",flexDirection:"column"},children:[...t]})})]})};w.__docgenInfo={description:"",methods:[],displayName:"ActionSet",props:{children:{required:!0,tsType:{name:"Array",elements:[{name:"ReactNode"}],raw:"ReactNode[]"},description:""},itemType:{required:!0,tsType:{name:"union",raw:"'ReplyItem' | 'CommentItem'",elements:[{name:"literal",value:"'ReplyItem'"},{name:"literal",value:"'CommentItem'"}]},description:""}}};const N=""+new URL("author-B-Cfy9t9.svg",import.meta.url).href,j=t=>{const{displayName:n,isCommentAuthor:o=!1,photo:i}=t,r=n?`Avatar of ${n}`:"Avatar of comment author";return e.jsxs(e.Fragment,{children:[o&&e.jsx(B,{src:N,ml:1,mt:-10,sx:{marginLeft:["-10px","5px"],marginTop:["-35px","-35px"],width:["85px","85px"],zIndex:1,position:"absolute",pointerEvents:"none",maxWidth:"none"}}),e.jsx(q,{"data-cy":"commentAvatarImage",src:i??L,sx:{objectFit:"cover",width:["30px","50px"],height:["30px","50px"],...o&&{zIndex:2,position:"relative"}},alt:r,loading:"lazy"})]})};j.__docgenInfo={description:"",methods:[],displayName:"CommentAvatar",props:{displayName:{required:!1,tsType:{name:"string"},description:""},isCommentAuthor:{required:!1,tsType:{name:"boolean"},description:""},photo:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""}}};const z=129,I=({body:t})=>{const n=l.createRef(),[o,i]=l.useState(0),[r,a]=l.useState(!1);l.useEffect((()=>{n.current&&i(n.current.scrollHeight)}),[n]);const s=r?"max-content":"128px";return e.jsxs(e.Fragment,{children:[e.jsx(f,{"data-cy":"comment-text","data-testid":"commentText",sx:{fontFamily:"body",lineHeight:1.3,maxHeight:s,overflow:"hidden",wordBreak:"break-word",whiteSpace:"pre-wrap",fontSize:[2,3]},ref:n,children:e.jsx(A,{children:t})}),o>z&&e.jsx(f,{as:"a",onClick:()=>{a((e=>!e))},sx:{color:"gray",cursor:"pointer",fontSize:[2,3]},children:r?"Show less":"Show more"})]})};I.__docgenInfo={description:"",methods:[],displayName:"CommentBody",props:{body:{required:!0,tsType:{name:"string"},description:""}}};const M=l.createContext({authors:[]}),T=t=>{const{hasUserVotedUseful:n,votedUsefulCount:o,isLoggedIn:i,sx:r,onUsefulClick:s}=t.usefulButtonLiteConfig,{theme:d}=U(),m=k(),u=l.useMemo((()=>(16*Math.random()).toString()),[]),[c,p]=l.useState(),g=n?"delete":"add",x=o&&0!==o?d.colors.background:"transparent";return e.jsxs(a,{sx:{alignSelf:"flex-end",position:"relative",alignItems:"center"},children:[o>0&&e.jsx(a,{sx:{position:"absolute",left:-6,backgroundColor:x,lineHeight:"1rem",minWidth:"2.75rem",width:"fit-content",height:"1.5rem",borderTopLeftRadius:1,borderBottomLeftRadius:1,justifyContent:"flex-start",alignItems:"center",padding:"4px 4px 4px 8px",fontSize:"14px",zIndex:1},children:e.jsx(f,{children:o??0})}),e.jsx(y,{type:"button","data-tooltip-id":u,"data-tooltip-content":i?"":"Login to add your vote","data-cy":i?"vote-useful":"vote-useful-redirect",title:"Mark as useful",onClick:()=>i?(async()=>{p(!0);try{await s(g,"Comment")}catch{}p(!1)})():m("/sign-in?returnUrl="+encodeURIComponent(location.pathname)),disabled:c,variant:"outline",sx:{position:"relative",fontSize:1,border:"none",padding:1,paddingRight:8,paddingLeft:8,display:"flex",alignItems:"center",width:"2rem",height:"2rem",gap:1,zIndex:2,...r},children:e.jsx(a,{sx:{alignItems:"center"},children:e.jsx(R,{glyph:"star-active",size:24,filter:n?"unset":"grayscale(1)"})})})]})};T.__docgenInfo={description:"",methods:[],displayName:"UsefulButtonLite",props:{usefulButtonLiteConfig:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  hasUserVotedUseful: boolean\n  votedUsefulCount: number\n  isLoggedIn: boolean\n  onUsefulClick: (\n    vote: 'add' | 'delete',\n    eventCategory?: string,\n  ) => Promise<void>\n  sx?: ThemeUIStyleObject\n}",signature:{properties:[{key:"hasUserVotedUseful",value:{name:"boolean",required:!0}},{key:"votedUsefulCount",value:{name:"number",required:!0}},{key:"isLoggedIn",value:{name:"boolean",required:!0}},{key:"onUsefulClick",value:{name:"signature",type:"function",raw:"(\n  vote: 'add' | 'delete',\n  eventCategory?: string,\n) => Promise<void>",signature:{arguments:[{type:{name:"union",raw:"'add' | 'delete'",elements:[{name:"literal",value:"'add'"},{name:"literal",value:"'delete'"}]},name:"vote"},{type:{name:"string"},name:"eventCategory"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!0}},{key:"sx",value:{name:"ThemeUIStyleObject",required:!1}}]}},description:""}}};const _="The original comment got deleted",O=t=>{var n,o,i,r,s;const{comment:d,itemType:m,isEditable:u,followButton:c,followButtonIcon:p,setShowDeleteModal:g,setShowEditModal:x,usefulButtonConfig:h}=t,{authors:v}=l.useContext(M),b=""+(d.highlighted?"2px dashed black":"none");return d.deleted?e.jsx(C,{sx:{marginBottom:2,border:b},"data-cy":"deletedComment",children:e.jsxs(f,{sx:{color:"grey"},children:["[",_,"]"]})}):d.deleted?void 0:e.jsxs(a,{sx:{gap:2,flexGrow:1,border:b},"data-cy":d.highlighted?"highlighted-comment":"",children:[e.jsx(C,{"data-cy":"commentAvatar","data-testid":"commentAvatar",sx:{flexDirection:"column",position:"relative",display:"inline-block"},children:e.jsx(j,{displayName:null==(n=d.createdBy)?void 0:n.displayName,photo:null==(i=null==(o=d.createdBy)?void 0:o.photo)?void 0:i.publicUrl,isCommentAuthor:!(null==(r=d.createdBy)||!r.id)&&v.includes(null==(s=d.createdBy)?void 0:s.id)})}),e.jsx(a,{sx:{flexDirection:"column",flex:1},children:e.jsxs(a,{sx:{justifyContent:"space-between",flexDirection:"column",gap:1},children:[e.jsxs(a,{sx:{gap:2,flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs(a,{sx:{alignItems:"center",gap:2},children:[d.createdBy&&e.jsx(E,{user:d.createdBy}),e.jsx(f,{sx:{fontSize:1,color:"darkGrey"},children:e.jsx(D,{createdAt:d.createdAt,showLabel:!1})})]}),e.jsxs(a,{children:[p,e.jsxs(w,{itemType:m,children:[c,u&&e.jsx(y,{type:"button","data-cy":`${m}: edit button`,variant:"subtle",icon:"edit",onClick:()=>x(!0),sx:{fontSize:1},children:"Edit"}),u&&e.jsx(y,{type:"button","data-cy":`${m}: delete button`,variant:"subtle",icon:"delete",onClick:()=>g(!0),sx:{fontSize:1},children:"Delete"})]})]})]}),e.jsxs(a,{sx:{flexDirection:"column"},children:[e.jsx(I,{body:d.comment}),e.jsx(T,{usefulButtonLiteConfig:h})]})]})})]})};O.__docgenInfo={description:"",methods:[],displayName:"CommentDisplay",props:{comment:{required:!0,tsType:{name:"Comment"},description:""},itemType:{required:!0,tsType:{name:"union",raw:"'ReplyItem' | 'CommentItem'",elements:[{name:"literal",value:"'ReplyItem'"},{name:"literal",value:"'CommentItem'"}]},description:""},isEditable:{required:!0,tsType:{name:"union",raw:"boolean | undefined",elements:[{name:"boolean"},{name:"undefined"}]},description:""},setShowDeleteModal:{required:!0,tsType:{name:"signature",type:"function",raw:"(arg: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"arg"}],return:{name:"void"}}},description:""},setShowEditModal:{required:!0,tsType:{name:"signature",type:"function",raw:"(arg: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"arg"}],return:{name:"void"}}},description:""},usefulButtonConfig:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  hasUserVotedUseful: boolean\n  votedUsefulCount: number\n  isLoggedIn: boolean\n  onUsefulClick: (\n    vote: 'add' | 'delete',\n    eventCategory?: string,\n  ) => Promise<void>\n  sx?: ThemeUIStyleObject\n}",signature:{properties:[{key:"hasUserVotedUseful",value:{name:"boolean",required:!0}},{key:"votedUsefulCount",value:{name:"number",required:!0}},{key:"isLoggedIn",value:{name:"boolean",required:!0}},{key:"onUsefulClick",value:{name:"signature",type:"function",raw:"(\n  vote: 'add' | 'delete',\n  eventCategory?: string,\n) => Promise<void>",signature:{arguments:[{type:{name:"union",raw:"'add' | 'delete'",elements:[{name:"literal",value:"'add'"},{name:"literal",value:"'delete'"}]},name:"vote"},{type:{name:"string"},name:"eventCategory"}],return:{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}},required:!0}},{key:"sx",value:{name:"ThemeUIStyleObject",required:!1}}]}},description:""},followButton:{required:!1,tsType:{name:"ReactNode"},description:""},followButtonIcon:{required:!1,tsType:{name:"ReactNode"},description:""}}};export{O as C};