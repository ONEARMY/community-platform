{"version":3,"file":"CommentItem-6c4cb62b.js","sources":["../../src/CommentItem/CommentItem.tsx"],"sourcesContent":["import { createRef, useEffect, useState } from 'react'\nimport { Avatar, Box, Flex, Text } from 'theme-ui'\n\nimport { Button } from '../Button/Button'\nimport { ConfirmModal } from '../ConfirmModal/ConfirmModal'\nimport { EditComment } from '../EditComment/EditComment'\nimport { LinkifyText } from '../LinkifyText/LinkifyText'\nimport { Modal } from '../Modal/Modal'\nimport { Username } from '../Username/Username'\n\nimport type { IComment } from './types'\n\nconst SHORT_COMMENT = 129\n\nexport interface IProps {\n  comment: IComment\n  handleDelete?: (commentId: string) => Promise<void>\n  handleEdit?: (commentId: string, newCommentText: string) => void\n  handleEditRequest?: (commentId: string) => Promise<void>\n  isReply: boolean\n  showAvatar: boolean\n}\n\nconst formatDate = (d: string | undefined): string => {\n  if (!d) {\n    return ''\n  }\n  return new Date(d).toLocaleDateString('en-GB').replace(/\\//g, '-')\n}\n\nexport const CommentItem = (props: IProps) => {\n  const textRef = createRef<any>()\n  const [showEditModal, setShowEditModal] = useState(false)\n  const [showDeleteModal, setShowDeleteModal] = useState(false)\n  const [textHeight, setTextHeight] = useState(0)\n  const [isShowMore, setShowMore] = useState(false)\n  const {\n    comment,\n    handleDelete,\n    handleEditRequest,\n    handleEdit,\n    isReply,\n    showAvatar,\n  } = props\n  const {\n    text,\n    creatorName,\n    creatorCountry,\n    creatorImage,\n    isUserVerified,\n    isUserSupporter,\n    isEditable,\n    _created,\n    _edited,\n    _id,\n  } = comment\n\n  const user = {\n    userName: creatorName,\n    countryCode: creatorCountry,\n    isVerified: !!isUserVerified,\n    isSupporter: !!isUserSupporter,\n  }\n\n  const date = formatDate(_edited || _created)\n  const maxHeight = isShowMore ? 'max-content' : '128px'\n\n  useEffect(() => {\n    if (textRef.current) {\n      setTextHeight(textRef.current.scrollHeight)\n    }\n  }, [textRef])\n\n  const showMore = () => {\n    setShowMore(!isShowMore)\n  }\n\n  const onEditRequest = (_id: string) => {\n    if (handleEditRequest) {\n      handleEditRequest(_id)\n      return setShowEditModal(true)\n    }\n  }\n\n  return (\n    <Flex\n      id={`comment:${_id}`}\n      data-cy=\"comment\"\n      sx={{ flexDirection: 'column' }}\n    >\n      <Flex sx={{ gap: 2 }}>\n        {creatorImage && showAvatar && (\n          <Box data-cy=\"commentAvatar\" data-testid=\"commentAvatar\">\n            <Avatar\n              src={creatorImage}\n              sx={{\n                objectFit: 'cover',\n                width: ['30px', '50px'],\n                height: ['30px', '50px'],\n              }}\n            />\n          </Box>\n        )}\n\n        <Flex\n          sx={{\n            flexDirection: 'column',\n            flex: 1,\n          }}\n        >\n          <Flex\n            sx={{\n              alignItems: 'stretch',\n              flexWrap: 'wrap',\n              justifyContent: 'flex-start',\n              flexDirection: ['column', 'row'],\n              gap: 2,\n            }}\n          >\n            <Flex\n              sx={{\n                alignItems: 'baseline',\n                gap: 2,\n                flexDirection: 'row',\n              }}\n            >\n              <Username user={user} />\n              {_edited && (\n                <Text sx={{ fontSize: 0, color: 'grey' }}>(Edited)</Text>\n              )}\n              <Text sx={{ fontSize: 1 }}>{date}</Text>\n            </Flex>\n\n            {isEditable && (\n              <Flex\n                sx={{\n                  flexGrow: 1,\n                  gap: 2,\n                  justifyContent: ['flex-start', 'flex-end'],\n                  opacity: 0.5,\n                  ':hover': { opacity: 1 },\n                }}\n              >\n                <Button\n                  data-cy=\"CommentItem: edit button\"\n                  variant=\"outline\"\n                  small={true}\n                  icon=\"edit\"\n                  onClick={() => onEditRequest(_id)}\n                >\n                  edit\n                </Button>\n                <Button\n                  data-cy=\"CommentItem: delete button\"\n                  variant={'outline'}\n                  small={true}\n                  icon=\"delete\"\n                  onClick={() => setShowDeleteModal(true)}\n                >\n                  delete\n                </Button>\n              </Flex>\n            )}\n          </Flex>\n          <Text\n            data-cy=\"comment-text\"\n            sx={{\n              fontFamily: 'body',\n              lineHeight: 1.3,\n              maxHeight,\n              overflow: 'hidden',\n              whiteSpace: 'pre-wrap',\n              wordBreak: 'break-word',\n              marginY: 2,\n            }}\n            ref={textRef}\n          >\n            <LinkifyText>{text}</LinkifyText>\n          </Text>\n          {textHeight > SHORT_COMMENT && (\n            <a\n              onClick={showMore}\n              style={{\n                color: 'gray',\n                cursor: 'pointer',\n              }}\n            >\n              {isShowMore ? 'Show less' : 'Show more'}\n            </a>\n          )}\n        </Flex>\n      </Flex>\n\n      <Modal width={600} isOpen={showEditModal}>\n        <EditComment\n          comment={text}\n          handleSubmit={(commentText) => {\n            handleEdit && handleEdit(_id, commentText)\n            setShowEditModal(false)\n          }}\n          handleCancel={() => setShowEditModal(false)}\n          isReply={isReply}\n        />\n      </Modal>\n\n      <ConfirmModal\n        isOpen={showDeleteModal}\n        message=\"Are you sure you want to delete this comment?\"\n        confirmButtonText=\"Delete\"\n        handleCancel={() => setShowDeleteModal(false)}\n        handleConfirm={() => {\n          handleDelete && handleDelete(_id)\n          setShowDeleteModal(false)\n        }}\n      />\n    </Flex>\n  )\n}\n"],"names":["SHORT_COMMENT","formatDate","d","CommentItem","props","textRef","createRef","showEditModal","setShowEditModal","useState","showDeleteModal","setShowDeleteModal","textHeight","setTextHeight","isShowMore","setShowMore","comment","handleDelete","handleEditRequest","handleEdit","isReply","showAvatar","text","creatorName","creatorCountry","creatorImage","isUserVerified","isUserSupporter","isEditable","_created","_edited","_id","user","date","maxHeight","useEffect","showMore","onEditRequest","_id2","jsxs","Flex","jsx","Box","Avatar","Username","Text","Button","LinkifyText","Modal","EditComment","commentText","ConfirmModal"],"mappings":"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"}