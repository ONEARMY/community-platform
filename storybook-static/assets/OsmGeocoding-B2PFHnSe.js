import{r as e,j as y}from"./iframe-DcRPcggf.js";import{S as _}from"./SearchField-BVcfv33T.js";import{a as C,T as F}from"./theme-ui-components.esm-BmKkfoQf.js";import{j as E}from"./theme-ui-core-jsx-runtime.browser.esm-DMR0i_-_.js";function G(r,t,n){var a=this,o=e.useRef(null),i=e.useRef(0),u=e.useRef(null),c=e.useRef([]),s=e.useRef(),d=e.useRef(),l=e.useRef(r),p=e.useRef(!0);e.useEffect((function(){l.current=r}),[r]);var m=!t&&0!==t&&typeof window<"u";if("function"!=typeof r)throw new TypeError("Expected a function");t=+t||0;var f=!!(n=n||{}).leading,g=!("trailing"in n)||!!n.trailing,h="maxWait"in n,y=h?Math.max(+n.maxWait||0,t):null;e.useEffect((function(){return p.current=!0,function(){p.current=!1}}),[]);var b=e.useMemo((function(){var e=function(e){var r=c.current,t=s.current;return c.current=s.current=null,i.current=e,d.current=l.current.apply(t,r)},r=function(e,r){m&&cancelAnimationFrame(u.current),u.current=m?requestAnimationFrame(e):setTimeout(e,r)},n=function(e){if(!p.current)return!1;var r=e-o.current;return!o.current||r>=t||r<0||h&&e-i.current>=y},b=function(r){return u.current=null,g&&c.current?e(r):(c.current=s.current=null,d.current)},x=function e(){var a=Date.now();if(n(a))return b(a);if(p.current){var u=t-(a-o.current),c=h?Math.min(u,y-(a-i.current)):u;r(e,c)}},R=function(){var l=Date.now(),m=n(l);if(c.current=[].slice.call(arguments),s.current=a,o.current=l,m){if(!u.current&&p.current)return i.current=o.current,r(x,t),f?e(o.current):d.current;if(h)return r(x,t),e(o.current)}return u.current||r(x,t),d.current};return R.cancel=function(){u.current&&(m?cancelAnimationFrame(u.current):clearTimeout(u.current)),i.current=0,c.current=o.current=s.current=u.current=null},R.isPending=function(){return!!u.current},R.flush=function(){return u.current?b(Date.now()):d.current},R}),[f,h,t,y,g,m]);return b}const A=()=>y.jsx(y.Fragment,{children:y.jsx(C,{sx:{background:"white",position:"relative",zIndex:1,marginTop:"-2px",paddingX:2,paddingY:1,border:"2px solid",borderColor:"black",borderTopWidth:"1px",lineHeight:1.5,borderBottomLeftRadius:1,borderBottomRightRadius:1},children:y.jsx(F,{sx:{fontSize:1},children:"Fetching results from Open Street Map"})})});A.__docgenInfo={description:"",methods:[],displayName:"OsmGeocodingLoader"};const O=e=>{const{results:r,callback:t,setShowResults:n}=e;return E(C,{"data-cy":"osm-geocoding-results",as:"ul",sx:{background:"white",padding:0,position:"relative",zIndex:1,margin:"-2px 0 0",border:"2px solid black",borderTopWidth:"1px",listStyle:"none",borderRadius:0,borderBottomLeftRadius:1,borderBottomRightRadius:1},children:r.map(((e,r)=>E(C,{as:"li",sx:{paddingY:1,paddingX:2,lineHeight:1.5,"&:hover":{background:"softblue",cursor:"pointer"}},onClick:()=>{n(!1),t&&t(e)},children:null==e?void 0:e.display_name},r)))})};O.__docgenInfo={description:"",methods:[],displayName:"OsmGeocodingResultsList",props:{results:{required:!0,tsType:{name:"Array",elements:[{name:"Result"}],raw:"Result[]"},description:""},callback:{required:!0,tsType:{name:"any"},description:""},setShowResults:{required:!0,tsType:{name:"ReactDispatch",raw:"React.Dispatch<React.SetStateAction<boolean>>",elements:[{name:"ReactSetStateAction",raw:"React.SetStateAction<boolean>",elements:[{name:"boolean"}]}]},description:""}}};const I=({placeholder:r="Search for an address",debounceMs:t=800,callback:n,acceptLanguage:a="en",viewbox:o="",loading:i=!1})=>{const[u,c]=e.useState(""),[s,d]=e.useState([]),[l,p]=e.useState(!1),[m,f]=e.useState(i),[g,h]=e.useState(!1),b=e.useRef(null);document.addEventListener("click",(function(e){var r;(null==(r=null==b?void 0:b.current)?void 0:r.contains(e.target))||p(!1)})),document.onkeyup=function(e){"Escape"===e.key&&p(!1)};const x=!!s.length&&l&&!m,R=G((e=>function(e=""){if(0===e.length)return;f(!0);let r=`https://nominatim.openstreetmap.org/search?format=json&q=${e}&accept-language=${a}`;o.length&&(r=`${r}&viewbox=${o}&bounded=1`),fetch(r,{headers:new Headers({"User-Agent":"onearmy.earth Community Platform (https://platform.onearmy.earth)"})}).then((e=>e.json())).then((e=>{d(e),p(!0)})).catch(null).finally((()=>f(!1)))}(e)),t);return e.useEffect((()=>{g&&R(u)}),[u,g,R]),y.jsxs("div",{"data-cy":"osm-geocoding",ref:b,style:{width:"100%"},children:[y.jsx(_,{autoComplete:"off",name:"geocoding",id:"geocoding",dataCy:"osm-geocoding-input",placeHolder:r,value:u,onChange:e=>{h(!0),c(e)},onClickDelete:()=>{c(""),h(!1)},onClickSearch:()=>{h(!0),c(u)},additionalStyle:{background:"white",fontFamily:"Varela Round",fontSize:"14px",border:"2px solid black",height:"44px",display:"flex",borderRadius:x||m?"5px 5px 0 0":"5px",marginBottom:0}}),m&&y.jsx(A,{}),x&&y.jsx(O,{results:s,callback:e=>{e&&(h(!1),c(e.display_name)),n(e)},setShowResults:p})]})};I.__docgenInfo={description:"",methods:[],displayName:"OsmGeocoding",props:{placeholder:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'Search for an address'",computed:!1}},debounceMs:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"800",computed:!1}},iconUrl:{required:!1,tsType:{name:"string"},description:""},callback:{required:!1,tsType:{name:"any"},description:""},city:{required:!1,tsType:{name:"string"},description:""},countrycodes:{required:!1,tsType:{name:"string"},description:""},acceptLanguage:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'en'",computed:!1}},viewbox:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},loading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{I as O,O as a};