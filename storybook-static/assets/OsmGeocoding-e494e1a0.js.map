{"version":3,"file":"OsmGeocoding-e494e1a0.js","sources":["../../src/OsmGeocoding/OsmGeocodingResultsList.tsx","../../../../node_modules/use-debounce/dist/index.module.js","../../src/OsmGeocoding/OsmGeocodingLoader.tsx","../../src/OsmGeocoding/OsmGeocoding.tsx"],"sourcesContent":["/** @jsxImportSource theme-ui */\nimport { Box } from 'theme-ui'\nimport type { Result } from './types'\n\nexport interface Props {\n  results: Result[]\n  callback: any\n  setShowResults: React.Dispatch<React.SetStateAction<boolean>>\n}\n\nexport const OsmGeocodingResultsList = (props: Props) => {\n  const { results, callback, setShowResults } = props\n  return (\n    <Box\n      data-cy=\"osm-geocoding-results\"\n      as=\"ul\"\n      sx={{\n        background: 'white',\n        padding: 0,\n        position: 'relative',\n        zIndex: 1,\n        margin: '-2px 0 0',\n        border: `2px solid black`,\n        borderTopWidth: '1px',\n        listStyle: 'none',\n        borderRadius: 0,\n        borderBottomLeftRadius: 1,\n        borderBottomRightRadius: 1,\n      }}\n    >\n      {results.map((result: Result, index: number) => (\n        <Box\n          as=\"li\"\n          sx={{\n            paddingY: 1,\n            paddingX: 2,\n            lineHeight: 1.5,\n            '&:hover': {\n              background: 'softblue',\n              cursor: 'pointer',\n            },\n          }}\n          key={index}\n          onClick={() => {\n            setShowResults(false)\n            if (callback) {\n              callback(result)\n            }\n          }}\n        >\n          {result?.display_name}\n        </Box>\n      ))}\n    </Box>\n  )\n}\n","import{useRef as r,useEffect as n,useMemo as t,useCallback as u,useState as e}from\"react\";function c(u,e,c){var i=this,a=r(null),o=r(0),f=r(null),l=r([]),m=r(),v=r(),d=r(u),p=r(!0);n(function(){d.current=u},[u]);var g=!e&&0!==e&&\"undefined\"!=typeof window;if(\"function\"!=typeof u)throw new TypeError(\"Expected a function\");e=+e||0;var w=!!(c=c||{}).leading,s=!(\"trailing\"in c)||!!c.trailing,x=\"maxWait\"in c,y=x?Math.max(+c.maxWait||0,e):null;n(function(){return p.current=!0,function(){p.current=!1}},[]);var h=t(function(){var r=function(r){var n=l.current,t=m.current;return l.current=m.current=null,o.current=r,v.current=d.current.apply(t,n)},n=function(r,n){g&&cancelAnimationFrame(f.current),f.current=g?requestAnimationFrame(r):setTimeout(r,n)},t=function(r){if(!p.current)return!1;var n=r-a.current;return!a.current||n>=e||n<0||x&&r-o.current>=y},u=function(n){return f.current=null,s&&l.current?r(n):(l.current=m.current=null,v.current)},c=function r(){var c=Date.now();if(t(c))return u(c);if(p.current){var i=e-(c-a.current),f=x?Math.min(i,y-(c-o.current)):i;n(r,f)}},h=function(){var u=Date.now(),d=t(u);if(l.current=[].slice.call(arguments),m.current=i,a.current=u,d){if(!f.current&&p.current)return o.current=a.current,n(c,e),w?r(a.current):v.current;if(x)return n(c,e),r(a.current)}return f.current||n(c,e),v.current};return h.cancel=function(){f.current&&(g?cancelAnimationFrame(f.current):clearTimeout(f.current)),o.current=0,l.current=a.current=m.current=f.current=null},h.isPending=function(){return!!f.current},h.flush=function(){return f.current?u(Date.now()):v.current},h},[w,x,e,y,s,g]);return h}function i(r,n){return r===n}function a(r){return\"function\"==typeof r?function(){return r}:r}function o(n,t,o){var f,l,m=o&&o.equalityFn||i,v=(f=e(a(n)),l=f[1],[f[0],u(function(r){return l(a(r))},[])]),d=v[0],p=v[1],g=c(u(function(r){return p(r)},[p]),t,o),w=r(n);return m(w.current,n)||(g(n),w.current=n),[d,g]}function f(r,n,t){var u=void 0===t?{}:t,e=u.leading,i=u.trailing;return c(r,n,{maxWait:n,leading:void 0===e||e,trailing:void 0===i||i})}export{o as useDebounce,c as useDebouncedCallback,f as useThrottledCallback};\n//# sourceMappingURL=index.module.js.map\n","import { Box, Text } from 'theme-ui'\n\nexport const OsmGeocodingLoader = () => {\n  return (\n    <>\n      <Box\n        sx={{\n          background: 'white',\n          position: 'relative',\n          zIndex: 1,\n          marginTop: '-2px',\n          paddingX: 2,\n          paddingY: 1,\n          border: '2px solid',\n          borderColor: 'black',\n          borderTopWidth: '1px',\n          lineHeight: 1.5,\n          borderBottomLeftRadius: 1,\n          borderBottomRightRadius: 1,\n        }}\n      >\n        <Text sx={{ fontSize: 1 }}>Fetching results from Open Street Map</Text>\n      </Box>\n    </>\n  )\n}\n","import { useState, useRef, useEffect } from 'react'\nimport { Input } from 'theme-ui'\nimport { OsmGeocodingResultsList } from './OsmGeocodingResultsList'\nimport { useDebouncedCallback } from 'use-debounce'\nimport { OsmGeocodingLoader } from './OsmGeocodingLoader'\nimport type { Result } from './types'\n\nexport interface Props {\n  placeholder?: string\n  debounceMs?: number\n  iconUrl?: string\n  callback?: any\n  city?: string\n  countrycodes?: string\n  acceptLanguage?: string\n  viewbox?: string\n  loading?: boolean\n}\n\nexport const OsmGeocoding = ({\n  placeholder = 'Search for an address',\n  debounceMs = 800,\n  callback,\n  acceptLanguage = 'en',\n  viewbox = '',\n  loading = false,\n}: Props) => {\n  const [searchValue, setSearchValue] = useState('')\n  const [results, setResults] = useState<Result[]>([])\n  const [showResults, setShowResults] = useState(false)\n  const [showLoader, setShowLoader] = useState(loading)\n  const [queryLocationService, setQueryLocationService] = useState(false)\n  const mainContainerRef = useRef<HTMLDivElement>(null)\n\n  document.addEventListener('click', function (event) {\n    const isClickInside = mainContainerRef?.current?.contains(\n      event.target as Node,\n    )\n    if (!isClickInside) {\n      setShowResults(false)\n    }\n  })\n\n  document.onkeyup = function (event) {\n    if (event.key === 'Escape') {\n      setShowResults(false)\n    }\n  }\n\n  function getGeocoding(address = '') {\n    if (address.length === 0) return\n\n    setShowLoader(true)\n\n    let url = `https://nominatim.openstreetmap.org/search?format=json&q=${address}&accept-language=${acceptLanguage}`\n\n    if (viewbox.length) {\n      url = `${url}&viewbox=${viewbox}&bounded=1`\n    }\n\n    fetch(url, {\n      headers: new Headers({\n        'User-Agent':\n          'onearmy.earth Community Platform (https://platform.onearmy.earth)',\n      }),\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        setResults(data)\n        setShowResults(true)\n      })\n      .catch(null)\n      .finally(() => setShowLoader(false))\n  }\n\n  const showResultsListing = !!results.length && showResults && !showLoader\n  const dcb = useDebouncedCallback(\n    (search: string) => getGeocoding(search),\n    debounceMs,\n  )\n\n  useEffect(() => {\n    if (queryLocationService) {\n      dcb(searchValue)\n    }\n  }, [searchValue, queryLocationService])\n\n  return (\n    <div\n      data-cy=\"osm-geocoding\"\n      ref={mainContainerRef}\n      style={{ width: '100%' }}\n    >\n      <Input\n        autoComplete=\"off\"\n        type=\"search\"\n        name=\"geocoding\"\n        id=\"geocoding\"\n        data-cy=\"osm-geocoding-input\"\n        placeholder={placeholder}\n        value={searchValue}\n        style={{\n          width: '100%',\n          background: 'white',\n          fontFamily: 'Varela Round',\n          fontSize: '14px',\n          border: '2px solid black',\n          height: '44px',\n          display: 'flex',\n          borderRadius:\n            showResultsListing || showLoader ? '5px 5px 0 0' : '5px',\n          marginBottom: 0,\n        }}\n        onClick={() => setShowResults(true)}\n        onChange={(event) => {\n          setQueryLocationService(true)\n          setSearchValue(event.target.value)\n        }}\n      />\n      {showLoader && <OsmGeocodingLoader />}\n      {showResultsListing && (\n        <OsmGeocodingResultsList\n          results={results}\n          callback={(result: Result) => {\n            if (result) {\n              setQueryLocationService(false)\n              setSearchValue(result.display_name)\n            }\n\n            callback(result)\n          }}\n          setShowResults={setShowResults}\n        />\n      )}\n    </div>\n  )\n}\n"],"names":["OsmGeocodingResultsList","props","results","callback","setShowResults","jsx","Box","result","index","c","u","e","i","a","r","o","f","l","m","v","d","p","n","g","w","s","x","y","h","t","OsmGeocodingLoader","Fragment","Text","OsmGeocoding","placeholder","debounceMs","acceptLanguage","viewbox","loading","searchValue","setSearchValue","useState","setResults","showResults","showLoader","setShowLoader","queryLocationService","setQueryLocationService","mainContainerRef","useRef","event","_a","getGeocoding","address","url","response","data","showResultsListing","dcb","useDebouncedCallback","search","useEffect","jsxs","Input"],"mappings":"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","x_google_ignoreList":[1]}